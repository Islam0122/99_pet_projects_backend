# requirements.txt - Полный конспект

## Что такое requirements.txt

`requirements.txt` — это текстовый файл, который содержит список всех внешних библиотек (зависимостей) вашего Python-проекта с указанием их версий. Это стандартный способ управления зависимостями в Python.

## Зачем он нужен

### Основные цели

- **Воспроизводимость окружения** — другие разработчики или вы сами на другой машине сможете установить точно те же версии библиотек
- **Развёртывание проекта** — на сервере легко установить все нужные зависимости одной командой
- **Документирование зависимостей** — явно указываете, какие библиотеки использует ваш проект
- **Командная работа** — все члены команды работают с одинаковыми версиями библиотек
- **Избежание конфликтов** — фиксация версий помогает избежать проблем совместимости

## Структура файла

### Простой пример

```txt
flask==2.3.0
requests>=2.28.0
numpy==1.24.2
pandas<2.0.0
Django~=4.2.0
```

### Форматы указания версий

| Формат | Описание | Пример |
|--------|----------|---------|
| `==` | Точная версия | `flask==2.3.0` |
| `>=` | Версия или выше | `requests>=2.28.0` |
| `<=` | Версия или ниже | `numpy<=1.24.5` |
| `>` | Строго выше | `pandas>1.5.0` |
| `<` | Строго ниже | `scipy<1.10.0` |
| `~=` | Совместимая версия | `Django~=4.2.0` (разрешает 4.2.x) |
| `,` | Комбинация условий | `package>=1.0,<2.0` |

### Комментарии

```txt
# Веб-фреймворк
flask==2.3.0

# Работа с HTTP-запросами
requests>=2.28.0

# Научные вычисления
numpy==1.24.2
pandas<2.0.0
```

## Основные команды

### Установка зависимостей

```bash
# Установить все зависимости из файла
pip install -r requirements.txt

# Установить с обновлением уже установленных пакетов
pip install -r requirements.txt --upgrade
```

### Создание requirements.txt

```bash
# Создать файл со всеми установленными пакетами
pip freeze > requirements.txt

# Создать файл только с пакетами, используемыми в проекте (через pipreqs)
pip install pipreqs
pipreqs /путь/к/проекту
```

### Обновление зависимостей

```bash
# Обновить конкретный пакет
pip install --upgrade имя_пакета

# Обновить все пакеты (осторожно!)
pip list --outdated
pip install --upgrade пакет1 пакет2
```

## Работа с виртуальными окружениями

### Зачем нужно виртуальное окружение

Виртуальное окружение изолирует зависимости проекта от системных пакетов Python и других проектов.

### Создание и использование

```bash
# Создать виртуальное окружение
python -m venv venv

# Активировать (Windows)
venv\Scripts\activate

# Активировать (Linux/Mac)
source venv/bin/activate

# Установить зависимости в виртуальное окружение
pip install -r requirements.txt

# Деактивировать
deactivate
```

## Типичный рабочий процесс

### Для нового проекта

1. Создать виртуальное окружение
2. Активировать его
3. Установить нужные библиотеки: `pip install flask requests numpy`
4. Создать requirements.txt: `pip freeze > requirements.txt`
5. Закоммитить файл в Git

### Для существующего проекта

1. Склонировать репозиторий
2. Создать виртуальное окружение
3. Активировать его
4. Установить зависимости: `pip install -r requirements.txt`
5. Начать работу

## Дополнительные возможности

### Разделение зависимостей

Можно создать несколько файлов для разных окружений:

```txt
requirements.txt           # Базовые зависимости
requirements-dev.txt      # Зависимости для разработки
requirements-prod.txt     # Зависимости для продакшена
requirements-test.txt     # Зависимости для тестирования
```

**Пример requirements-dev.txt:**
```txt
-r requirements.txt       # Включить базовые зависимости
pytest==7.4.0
black==23.7.0
flake8==6.1.0
```

### Установка из Git-репозиториев

```txt
# Из ветки
git+https://github.com/user/repo.git@branch_name

# Из тега
git+https://github.com/user/repo.git@v1.0.0

# Из коммита
git+https://github.com/user/repo.git@abc123
```

### Локальные пакеты

```txt
# Установка из локальной директории
-e /путь/к/локальному/пакету

# Установка из файла wheel
./packages/my_package-1.0-py3-none-any.whl
```

## Лучшие практики

1. **Всегда используйте виртуальные окружения** — изолируйте зависимости проекта
2. **Фиксируйте версии** — используйте `==` для критически важных библиотек
3. **Регулярно обновляйте** — следите за обновлениями безопасности
4. **Минимизируйте зависимости** — устанавливайте только то, что реально используется
5. **Коммитьте в Git** — requirements.txt должен быть в репозитории
6. **Документируйте** — добавляйте комментарии для сложных зависимостей
7. **Используйте pipreqs** — для автоматического определения используемых пакетов

## Альтернативы

### Poetry

Современный инструмент управления зависимостями с файлом `pyproject.toml`:

```bash
poetry init
poetry add flask
poetry install
```

### Pipenv

Комбинирует pip и virtualenv, использует файлы `Pipfile` и `Pipfile.lock`:

```bash
pipenv install flask
pipenv install --dev pytest
```

### Conda

Для научных проектов, файл `environment.yml`:

```bash
conda env create -f environment.yml
```

## Частые проблемы и решения

### Ошибка установки пакета

```bash
# Обновить pip
pip install --upgrade pip

# Установить с опцией --no-cache-dir
pip install -r requirements.txt --no-cache-dir
```

### Конфликты версий

```bash
# Проверить зависимости
pip check

# Использовать pip-tools для разрешения конфликтов
pip install pip-tools
pip-compile requirements.in
```

### Слишком много пакетов в freeze

```bash
# Использовать pipreqs вместо freeze
pip install pipreqs
pipreqs . --force
```

## Полезные команды

```bash
# Показать установленные пакеты
pip list

# Показать информацию о пакете
pip show flask

# Показать устаревшие пакеты
pip list --outdated

# Удалить все пакеты
pip freeze | xargs pip uninstall -y

# Проверить requirements.txt на ошибки
pip install -r requirements.txt --dry-run
```

## Заключение

Файл `requirements.txt` — это стандарт в экосистеме Python для управления зависимостями. Правильное использование этого файла обеспечивает стабильность, воспроизводимость и упрощает развёртывание Python-проектов.