# üìò **node.md ‚Äî AUTH –≤ FastAPI (JWT + AuthX)**

````md
# Auth ‚Äî –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ FastAPI

## üìå –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è

### **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
–ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏—á–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
–ü—Ä–∏–º–µ—Ä: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email –∏ –ø–∞—Ä–æ–ª—å ‚Üí —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –≤–µ—Ä–Ω—ã–µ.

### **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
–ü—Ä–æ–≤–µ—Ä–∫–∞, –∏–º–µ–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ—Å—Ç—É–ø –∫ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º—É —Ä–µ—Å—É—Ä—Å—É.  
–ü—Ä–∏–º–µ—Ä: —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å `/protected`.

---

## üìå –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **FastAPI** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π backend-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫  
- **AuthX** ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JWT  
- **JWT (JSON Web Token)** ‚Äî —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏  
- **Cookies** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ JWT –≤–Ω—É—Ç—Ä–∏ HTTP-only cookie

---

## üìå –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã AuthX

1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email + –ø–∞—Ä–æ–ª—å –Ω–∞ `/login`
2. –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
3. –ï—Å–ª–∏ –≤—Å—ë –≤–µ—Ä–Ω–æ ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è JWT —Ç–æ–∫–µ–Ω
4. –¢–æ–∫–µ–Ω –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ **HTTP-only cookie**
5. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –±—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie
6. AuthX –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üìå –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ AuthX

```python
config = AuthXConfig(
    JWT_SECRET_KEY="SECRET_KEY",
    JWT_TOKEN_LOCATION=["cookies"],
    JWT_ACCESS_COOKIE_NAME="my_access_token",
    JWT_COOKIE_SECURE=False,    # –≤–∫–ª—é—á–∏—Ç—å True –ø—Ä–∏ HTTPS
    JWT_COOKIE_HTTPONLY=True,
    JWT_COOKIE_SAMESITE="lax",
)
security = AuthX(config=config)
````

### –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

* `JWT_SECRET_KEY` ‚Äî —Å–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–∞
* `JWT_TOKEN_LOCATION=["cookies"]` ‚Äî —Ç–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫—É–∫–∏
* `HTTPOnly` ‚Äî –Ω–µ–ª—å–∑—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ JS ‚Üí –±–µ–∑–æ–ø–∞—Å–Ω–æ
* `SameSite=lax` ‚Äî –∫—É–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

---

## üìå –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: Login

```python
@app.post("/login")
def login(creds: UserLoginSchema, response: Response):
    if creds.email == "test" and creds.password == "test":
        token = security.create_access_token(uid="12345678")

        response.set_cookie(
            key=config.JWT_ACCESS_COOKIE_NAME,
            value=token,
            httponly=True,
            samesite="lax",
            secure=False
        )

        return {"message": "Logged in"}
    
    raise HTTPException(401, "Incorrect username or password")
```

–ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–≤–∏—Ç—Å—è –≤ cookie.

---

## üìå –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ —Ä–æ—É—Ç—ã

```python
@app.get("/protected", dependencies=[Depends(security.access_token_required)])
def protected():
    return {"message": "You are authorized"}
```

–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç –∏–ª–∏ –æ–Ω –ø—Ä–æ—Å—Ä–æ—á–µ–Ω ‚Üí AuthX –≤–µ—Ä–Ω—ë—Ç 401.

---

## üìå Logout

```python
@app.post("/logout")
def logout(response: Response):
    response.delete_cookie(config.JWT_ACCESS_COOKIE_NAME)
    return {"message": "Logged out"}
```

---

## üìå –†–∞–±–æ—Ç–∞ —Ç–æ–∫–µ–Ω–∞

–ö–∞–∂–¥—ã–π JWT —Å–æ–¥–µ—Ä–∂–∏—Ç:

* `uid` ‚Äî ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
* `exp` ‚Äî –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
* `iat` ‚Äî –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è

AuthX —á–∏—Ç–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ cookie –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.

---

## üìå –ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ

* –ë–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (PostgreSQL)
* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (bcrypt)
* Refresh token
* –†–æ–ª–∏: Admin / User
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º

---


